<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .gridlines line{
        stroke: #bbb
      }
      .gridlines .domain{
        stroke: none
      }

    </style>
  </head>
  <body>
    <h3>Megan Jung mj374, Derek Ni dan82, Bhav Patel </h3>
    <p id="p1">
      1.
      <div id = "live_in_div"></div>
      <script>
        //Part A
        let divider_1 = d3.select("#live_in_div");
        divider_1.append("svg")
           .attr("width", "800")
           .attr("height", "400")
           .attr("id", "plot")

        const svg = d3.select("svg#plot");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = {top: 50, right: 50, bottom: 50, left: 50};
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        let annotations = svg.append("g").attr("id","annotations");
        let chartArea = svg.append("g").attr("id","chart-area")
                        .attr("transform",`translate(${margin.left},${margin.top})`);

        
        d3.json("mariokart_records.json").then((data) => {
          console.log(data)
//Part B
          const timeParser = d3.timeParse('%Y-%m-%d');
          const scaleTime = d3.scaleTime()
                              .domain([timeParser(data['earliest_date']), timeParser(data['latest_date'])])
                              .range([0,chartWidth]);

          const scaleLinear = d3.scaleLinear()
                                .domain([data['min_value'], data['max_value']])
                                .range([chartHeight, 0]);
          const scaleOrdinal = d3.scaleOrdinal(d3.schemeCategory10);


          //Part C
          let bottomAxis = d3.axisBottom(scaleTime)

          let bottomGridlines = d3.axisBottom(scaleTime)
                                  .tickSize(-chartHeight-10)
                                  .tickFormat("")
          annotations.append("g")
            .attr("class", "x axis")
            .attr("transform",`translate(${margin.left},${chartHeight + margin.top + 10})`)
            .call(bottomAxis);
          annotations.append("g")
            .attr("class", "x gridlines")
            .attr("transform",`translate(${margin.left},${chartHeight + margin.top + 10})`)
            .call(bottomGridlines);

          let leftAxis = d3.axisLeft(scaleLinear)
          let leftGridlines = d3.axisLeft(scaleLinear)
                                .tickSize(-chartWidth-10)
                                .tickFormat("")
          annotations.append("g")
            .attr("class", "y axis")
            .attr("transform",`translate(${margin.left - 10},${margin.top})`)
            .call(leftAxis)
          annotations.append("g")
            .attr("class", "y gridlines")
            .attr("transform",`translate(${margin.left - 10},${margin.top})`)
            .call(leftGridlines);

          //Part D
          var lineGenerator = d3.line()
                    .x(value => scaleTime(timeParser(value['date'])))
                    .y(value => scaleLinear(value['record_time']))

          //Part E
          let gTags = chartArea.selectAll("g.track").data(data.timeseries)
                               .join("g")
                               .attr("class", "track")
                               .attr("id", d => d.track)
                               .style("stroke", d => scaleOrdinal(d.track));

          //Part F
          gTags.append("path")
               .attr("class", "line")
               .attr("fill", "none")
               .attr("stroke-width", 2)
               .attr("d", d => lineGenerator(d.values));

          //Part G
          gTags.selectAll('circle')
               .data(d => d.values)
               .join('circle')
               .attr("cx", v => scaleTime(timeParser(v.date)))
               .attr("cy", v => scaleLinear(v.record_time))
               .attr("r", 2)
               .attr("fill", v => scaleOrdinal(v.track));
       });
      </script>
    </p>
  </body>
</html>
